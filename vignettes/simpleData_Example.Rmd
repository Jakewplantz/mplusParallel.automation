---

output:
  html_document:
    df_print: paged
vignette: |
  %\VignetteIndexEntry{Simple Data Generation Example} %\VignetteEngine{knitr::rmarkdown} %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Simple Data Generation Example

This vignette provides a basic example of generating data and preparing an input file for use with the mplusParallel.automation package.

## Loading Package
```{r,results='hide',message=FALSE,warning=FALSE, echo = T}
library(mplusParallel.automation)

```

## Data Generation Function

The following code will generate a dataset with 500 people and 12 items. This won't be typical in simulations where there are many conditions, but is useful in showing the general set up of how the function expects it to be formatted.

```{r}

data_genFunk <- 
"
n_people <- 500
n_items <- 12

# Generate the data
data <- matrix(sample(1:5, n_people * n_items, replace = TRUE), ncol = n_items)
"
```

Note, all objects required for the function are named within it. mplusParallel_automation does not have access to the global environment. There is also no seed set within. This is done by the function.

## Writing an example input file
The input file content is specified as below:

```{r}
inp_content <- "
TITLE: TEST
DATA: FILE IS exdat.csv;
VARIABLE:
  Names ARE
i1 i2 i3 i4 i5 i6 i7 i8 i9 i10 i11 i12;
USEVARIABLES ARE i1-i12;
ANALYSIS:
TYPE = GENERAL;
PROCESSORS=6;
OUTPUT:
STANDARDIZED;
MODINDICES (ALL);
MODEL:
  trait1 BY
i1 (a1)
i2 (a2)
i3 (a3)
i4 (a4)
i5 (a5)
i6 (a6);
trait2 BY
i7 (a7)
i8 (a8)
i9 (a9)
i10 (a10)
i11 (a11)
i12 (a12);
i1-i12 (e);
trait1 @ 1
trait2 @ 1
"

# Write to an inp file
writeLines(inp_content, "example_model_simple.inp")
```

## Running mplusParallel_automation
To run the automation with the generated data we can use the following options. In this case, we are going to only extract the factor loadings usign the optional 'specific_params' argument.

```{r}
res <- mplusParallel_automation(k=5, data_gen = data_genFunk, results = 'parameters', specific_params = c('trait1.by', 'trait2.by'))

print(res[c(2,14,26,38,50),])
```

## Cleanup
After completion, you can remove any generated folders:

```{r}
removeParFolders()
```
